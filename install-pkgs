#!/usr/bin/env bash

set -x

set -e

#brew update
#brew tap homebrew/cask-drivers

while read pkg; do
 if test ! $(which pkg); then
   echo "Installing $pkg"
   brew install $pkg
 fi
done <pkgs-mac

while read cask; do
  if test ! $(which cask); then
    echo "Installing cask $cask"
    brew install --cask $cask
  fi
done <pkgs-mac-cask

brew install stern

brew cleanup

pip3 install flake8
pip3 install kapitan
pip3 install pgcli
pip3 install ps_mem

# Install minikube, should work for all linux
# https://github.com/kubernetes/minikube/releases
# curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64 \
# Install Keybase

# Install Oh-My-Zsh
#wget --no-check-certificate http://install.ohmyz.sh -O - | sh

# https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-working-with-install-plugin.html

if test ! $(which session-manager-plugin); then
  curl "https://s3.amazonaws.com/session-manager-downloads/plugin/latest/mac/sessionmanager-bundle.zip" -o "sessionmanager-bundle.zip"
  unzip sessionmanager-bundle.zip
  sudo ./sessionmanager-bundle/install -i /usr/local/sessionmanagerplugin -b /usr/local/bin/session-manager-plugin
fi


# after install virtualbox and kubectl will need:
# brew install minikube

# Install poetry
# https://python-poetry.org/docs/#installation
curl -sSL https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py | python

# Install autocompletion
source ~/.zshrc
mkdir $ZSH/plugins/poetry
poetry completions zsh > $ZSH/plugins/poetry/_poetry
