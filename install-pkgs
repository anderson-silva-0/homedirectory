#!/usr/bin/env bash

set -x

set -e

# update packages index
# sudo dnf update -y

# Gnome config
gsettings get org.gnome.desktop.wm.preferences focus-mode 'sloppy'
gsettings get org.gnome.desktop.wm.preferences auto-raise true

# set hostname as Fedora doesn't give it one during installation
hostnamectl set-hostname x1

# enable free and non-free 3rd party repos
sudo dnf install -y https://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-$(rpm -E %fedora).noarch.rpm https://download1.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-$(rpm -E %fedora).noarch.rpm

# INSTALLING GCLOUD THE GOOGLE WAY
# https://cloud.google.com/sdk/docs/downloads-yum
# Need to do `cloud-init` after this is all done

sudo tee -a /etc/yum.repos.d/google-cloud-sdk.repo << EOM
[google-cloud-sdk]
name=Google Cloud SDK
baseurl=https://packages.cloud.google.com/yum/repos/cloud-sdk-el7-x86_64
enabled=1
gpgcheck=1
repo_gpgcheck=1
gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg
       https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
EOM

# END OF INSTALLING GCLOUD THE GOOGLE WAY

while read pkg; do
  sudo dnf -y install $pkg
done <pkgs

# Add key and install repository for VSCode
sudo rpm --import https://packages.microsoft.com/keys/microsoft.asc
sudo sh -c 'echo -e "[code]\nname=Visual Studio Code\nbaseurl=https://packages.microsoft.com/yumrepos/vscode\nenabled=1\ngpgcheck=1\ngpgkey=https://packages.microsoft.com/keys/microsoft.asc" > /etc/yum.repos.d/vscode.repo'
# Update dnf and install vscode
dnf check-update | true
sudo dnf -y install code

# Install snapd for installing snaps later
sudo dnf -y install snapd
sudo ln -s /var/lib/snapd/snap /snap

# Installing Snapcraft stuff
sudo snap install atom --classic
sudo snap install bitwarden
sudo snap install google-play-music-desktop-player
sudo snap install simplenote
sudo snap install slack --classic # It seems snap works with Fedora KDE, yay!
sudo snap install spotify

# pip install flake8
python3 -m pip install --upgrade pip
python3 -m pip install --upgrade pip
pip install virtualenvwrapper
pip install pgcli
pip install kapitan

# Install mega nz file syncyng stuff
source /etc/os-release

wget https://mega.nz/linux/MEGAsync/Fedora_${VERSION_ID}/x86_64/megasync-Fedora_${VERSION_ID}.x86_64.rpm
wget https://mega.nz/linux/MEGAsync/Fedora_${VERSION_ID}/x86_64/nautilus-megasync-Fedora_${VERSION_ID}.x86_64.rpm

# Install minikube, should work for all linux
# https://github.com/kubernetes/minikube/releases
 curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64 \
   && sudo install minikube-linux-amd64 /usr/local/bin/minikube

# Install Keybase
sudo yum -y install https://prerelease.keybase.io/keybase_amd64.rpm
run_keybase

# Install Oh-My-Zsh
wget --no-check-certificate http://install.ohmyz.sh -O - | sh
# This is going to ask to change shell at end of installation so will exit then
